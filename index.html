<!DOCTYPE html>
    <head>
        <!-- Spotify CSS files -->
        <link rel="stylesheet" type="text/css" href="sp://resources/css/eve.css">
        <link rel="stylesheet" type="text/css" href="sp://resources/css/api.css">
        <link rel="stylesheet" type="text/css" href="sp://resources/css/player.css">
        <link rel="stylesheet" type="text/css" href="sp://resources/css/list.css">

        <!-- Project CSS files -->
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <link rel="stylesheet" type="text/css" href="css/github.css">

    </head>
    <body>
        <div id="wrapper">
            <div id="index" class="section">
                <h1>Showlist</h1>
				<p class="description">Drag playlists to the box, select sources of shows, then press Go.</p>

                <h4>Playlists</h4>
				    <div>
				        <div id="drop_box"></div>
				        <ul id="playlist"></ul>
				    </div>
		<form>
			<h4>Output &nbsp;&nbsp;&nbsp;<input type="button" onclick="window.print();" name="Print" value="Print"></h4>
		</form>
				   <div>
					<div id="output"></div>
				   </div>
				<script type="text/javascript">
				    var sp = getSpotifyApi();
				    var models = sp.require('$api/models');

				    // Handle drops
				    var drop_box = document.querySelector('#drop_box');

				    drop_box.addEventListener('dragstart', function(e){
				        e.dataTransfer.setData('text/html', this.innerHTML);
				        e.dataTransfer.effectAllowed = 'copy';
				    }, false);

				    drop_box.addEventListener('dragenter', function(e){
				        e.preventDefault();
				        e.dataTransfer.dropEffect = 'copy';
				        this.classList.add('over');
				    }, false);

				    drop_box.addEventListener('dragover', function(e){
				        e.preventDefault();
				        e.dataTransfer.dropEffect = 'copy';
				        return false;
				    }, false);

				    drop_box.addEventListener('dragleave', function(e){
				        e.preventDefault();
				        this.classList.remove('over');
				    }, false);

				    drop_box.addEventListener('drop', function(e){
				        e.preventDefault();
				        var drop = models.Playlist.fromURI(e.dataTransfer.getData('text'));
				        this.classList.remove('over');
				        var success_message = document.createElement('p');
				        success_message.innerHTML = 'Playlist successfully dropped: ' + drop.uri;
				        this.appendChild(success_message);
						drawPlaylist(drop.uri);
				    }, false);

					function drawPlaylist(playlist_url) {
					    var playlistHTML = document.getElementById('playlist');
					    var outputHTML = document.getElementById('output');

					    var pl = models.Playlist.fromURI(playlist_url, function(playlist) {
					        var fragment = document.createDocumentFragment();
					        for (var i = 0, l = playlist.tracks.length; i < l; i++){
					            var artist = document.createElement('div');
					            var a = document.createElement('a');
					            a.href = 'http://schedule.sxsw.com/search?q="' + playlist.tracks[i].artists[0].name + '"'; 
					            a.innerHTML = playlist.tracks[i].artists[0].name;
					            artist.appendChild(a);
					            fragment.appendChild(artist);
					        }
						
					        outputHTML.appendChild(fragment);
						});
					}

				</script>


            </div>
        </div>

	<div style="float:left; padding:20px">left</div>
	<div style="clear:none; padding:20px">right</div>

        <script src="/js/rainbow-custom.min.js"></script>
        <script src="/js/jquery.min.js"></script>
        <script src="/js/stub.js"></script>     
        <script type="text/javascript">
                window.onload = stub_shows
        </script>
    
</body>
</html>
